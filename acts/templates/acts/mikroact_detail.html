{% extends "base.html" %}
{% load guardian_tags %}
{% load comments %}
{% load crispy_forms_tags %}

{% block title %}{{ block.super }}: {{ mikroact.title }}{% endblock %}

{% block extra_head %}
	{{ block.super }}
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}fluent_comments/css/ajaxcomments.css" />
	<script type="text/javascript" src="{{ STATIC_URL }}fluent_comments/js/ajaxcomments.js"></script>
{% endblock %}

{% block content %}
{% get_obj_perms user for mikroact as "mikroact_perms" %}

<div class="container">
	<div class="row">
		<div class="span8">
			<div class="mainCol act">
				
				<div class="actGallery">
					{% if mikroact.photo %}
					<img src="{{ mikroact.photo.url }}" width="750" />
					{% else %}
					<img src="http://placecage.com/750/400" />
					{% endif %}
				</div>
				
						<div class="actions">
							<ul class="nav nav-tabs" id="actTabs">
							  <li class="active"><a href="#stream">Stream</a></li>
							  <li><a href="#instruction">Instructions</a></li>
							</ul>
							{% if user.is_authenticated %}
							<ul class="userAction">
								{% if "change_mikroact" in mikroact_perms %}
								<li><a href="{% url "mikroact_edit" slug=mikroact.slug %}">Edit MikroAct</a></li>
								{% endif %}
								{% if "delete_mikroact" in mikroact_perms %}
								<li><a href="{% url "mikroact_delete" slug=mikroact.slug %}">Delete MikroAct</a></li>
								{% endif %}
							</ul>
							{% else %}
							{% endif %}
						</div>
			</div>
			<div class="mainCol comment">
				<div class="tab-content">
					<div class="tab-pane active" id="stream">
						{% render_comment_list for mikroact %}
						{% if user.is_authenticated %}
						{% render_comment_form for mikroact %}
						{% else %}
						<a class="userLogin" href="{% url 'user_login' %}">Log in</a> to leave a comment
						{% endif %}
					</div>
					<div class="tab-pane" id="instruction">
						{{ mikroact.description }}
					</div>
				</div>
				
			</div>
		</div>
		<div class="span4">
			<div class="sideCol act">
				<h1>{{ mikroact.title }}</h1>
				<p class="desc">{{ mikroact.description }}</p>
				<p>{{ mikroact.location_address }}</p>
				<p class="status">Campaigns:</p>
				<ul>
					{% for campaign in mikroact.campaigns.all %}
					<li><a href="{{ campaign.get_absolute_url }}">{{ campaign.name }}</a></li>
					{% endfor %}
				</ul>
				<form action="{% url 'mikroact_campaign_add' slug=mikroact.slug %}" method="POST">
					{% csrf_token %}
					{{ campaign_form|crispy }}
					<button type="submit" class="btn btn-submit">Add</button>
			</div>
			
			<div class="sideCol author">
				<p><a href="{% url 'user_detail' username=mikroact.author %}">{{ mikroact.author }}</a></p>
			</div>
		</div>
		
	</div>
</div>
{% endblock content %}
